<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Dashboard - SafeNavi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="emp.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <img src="https://img.freepik.com/premium-vector/s-letter-logo-colorful-gradient-design_161396-885.jpg" alt="Logo">
                <h2>SafeNavi</h2>
            </div>
            <ul class="nav-links">
                <li class="active"><a href="emp.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="empwindow.html"><i class="fas fa-receipt"></i> My Expenses</a></li>
                <li><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
                <li><a href="#" class="disabled"><i class="fas fa-cog"></i> Settings</a></li>
                <li class="logout-li"><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                <li class="user-email">
                    <i class="fas fa-user-circle"></i>
                    <span id="userEmail"></span>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <header>
                <h1>Expense Dashboard</h1>
                <div class="header-actions">
                    <button id="newExpenseBtn" class="btn-primary">
                        <i class="fas fa-plus"></i> New Expense
                    </button>
                    <a href="empwindow.html" class="btn btn-outline">
                        <i class="fas fa-list"></i> View All Expenses
                    </a>
                </div>
            </header>

            <!-- Summary Cards -->
            <div class="summary-cards">
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="card-info">
                        <h3>Pending</h3>
                        <p id="pendingAmount">$0.00</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon approved">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="card-info">
                        <h3>Approved</h3>
                        <p id="approvedAmount">$0.00</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-icon rejected">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="card-info">
                        <h3>Rejected</h3>
                        <p id="rejectedAmount">$0.00</p>
                    </div>
                </div>
            </div>

            <!-- Expense Table -->
            <div class="expense-table">
                <div class="table-header">
                    <h2>Recent Expenses</h2>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchExpenses" placeholder="Search expenses...">
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Date <i class="fas fa-sort"></i></th>
                            <th>Category <i class="fas fa-sort"></i></th>
                            <th>Description</th>
                            <th>Amount <i class="fas fa-sort"></i></th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="expenseTableBody">
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- New Expense Modal -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Submit New Expense</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="expenseForm">
                    <div class="form-group">
                        <label for="expenseAmount">Amount</label>
                        <div class="amount-input">
                            <select id="expenseCurrency">
                                <option value="USD">$</option>
                                <option value="EUR">€</option>
                                <option value="GBP">£</option>
                            </select>
                            <input type="number" id="expenseAmount" step="0.01" min="0" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="expenseCategory">Category</label>
                        <select id="expenseCategory" required>
                            <option value="">Select a category</option>
                            <option value="travel">Travel</option>
                            <option value="food">Food</option>
                            <option value="accommodation">Accommodation</option>
                            <option value="office">Office Supplies</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="expenseDate">Date</label>
                        <input type="date" id="expenseDate" required>
                    </div>
                    <div class="form-group">
                        <label for="expenseDescription">Description</label>
                        <textarea id="expenseDescription" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="receiptUpload">Upload Receipt</label>
                        <div class="file-upload">
                            <input type="file" id="receiptUpload" accept="image/*,.pdf" required>
                            <label for="receiptUpload">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>Choose file or drag & drop (JPG, PNG, PDF)</span>
                            </label>
                            <div id="fileName">No file chosen</div>
                            <div id="receiptPreview" class="receipt-preview"></div>
                        </div>
                        <div class="ocr-options">
                            <div class="ocr-option">
                                <input type="checkbox" id="useOCR" checked>
                                <label for="useOCR">Use OCR to auto-fill details</label>
                            </div>
                            <button type="button" id="scanReceiptBtn" class="btn-text">
                                <i class="fas fa-camera"></i> Scan with Camera
                            </button>
                        </div>
                    </div>
                    <input type="hidden" id="expenseId">
                    <input type="hidden" id="expenseStatus" value="pending">
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancelExpense">Cancel</button>
                        <button type="button" class="btn-outline" id="saveDraftBtn">Save as Draft</button>
                        <button type="submit" class="btn-primary">Submit Expense</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Expense Details Modal -->
    <div id="expenseDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Expense Details</h2>
                <span class="close-details-modal">&times;</span>
            </div>
            <div class="modal-body" id="expenseDetailsContent">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Include auth.js -->
    <script src="auth.js"></script>
    <script>
        // Check authentication and role
        document.addEventListener('DOMContentLoaded', function() {
            const isAuthenticated = sessionStorage.getItem('isAuthenticated');
            const userRole = sessionStorage.getItem('userRole');
            const userEmail = sessionStorage.getItem('userEmail');
            
            // If not authenticated, redirect to login
            if (!isAuthenticated) {
                window.location.href = 'login.html';
                return;
            }
            
            // If user doesn't have employee role, redirect based on their role
            if (userRole !== 'employee') {
                if (userRole === 'manager' || userRole === 'admin') {
                    window.location.href = 'empwindow.html'; // Or manager dashboard when available
                }
            }
            
            // Set active navigation item
            const currentPage = window.location.pathname.split('/').pop() || 'emp.html';
            document.querySelectorAll('.nav-links a').forEach(link => {
                // Remove active class from all links
                link.parentElement.classList.remove('active');
                
                // Handle profile page active state
                if (currentPage === 'profile.html' && link.getAttribute('href') === 'profile.html') {
                    link.parentElement.classList.add('active');
                }
                // Handle other pages
                else if (link.getAttribute('href') === currentPage) {
                    link.parentElement.classList.add('active');
                }
                
                // Prevent default for disabled links
                if (link.classList.contains('disabled')) {
                    link.addEventListener('click', (e) => e.preventDefault());
                }
            });
            
            const userEmailElement = document.getElementById('userEmail');
            if (userEmailElement && userEmail) {
                userEmailElement.textContent = userEmail;
            }
            
            // Logout functionality
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    sessionStorage.removeItem('isAuthenticated');
                    sessionStorage.removeItem('userEmail');
                    window.location.href = 'login.html';
                });
            }
        });
    </script>
    <script src="emp.js"></script>
</body>
</html>
